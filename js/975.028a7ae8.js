"use strict";(self["webpackChunkctwing_shop_h5"]=self["webpackChunkctwing_shop_h5"]||[]).push([[975],{9975:function(t,e,s){s.r(e),s.d(e,{default:function(){return c}});var i=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"new-address"},[s("div",{staticClass:"content-box"},[s("van-form",[s("van-field",{attrs:{label:"收货人",placeholder:"请填写收货人姓名"},model:{value:t.form.contacter,callback:function(e){t.$set(t.form,"contacter",e)},expression:"form.contacter"}}),s("van-field",{attrs:{label:"联系电话",maxlength:"11",placeholder:"请输入联系电话"},model:{value:t.form.contactPhone,callback:function(e){t.$set(t.form,"contactPhone",e)},expression:"form.contactPhone"}}),s("van-field",{attrs:{readonly:"",label:"所在地",placeholder:"请选择所在地区"},on:{click:t.onOpen},model:{value:t.addressStr,callback:function(e){t.addressStr=e},expression:"addressStr"}}),s("van-popup",{attrs:{round:"",position:"bottom"},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[s("van-cascader",{attrs:{title:"请选择所在地区",options:t.addressList,"field-names":t.fieldNames},on:{close:t.onClose,change:t.onChangeCity,finish:t.onFinish},model:{value:t.cascaderValue,callback:function(e){t.cascaderValue=e},expression:"cascaderValue"}})],1),s("van-field",{attrs:{label:"详细地址",placeholder:"请输入详细地址（无需重复省市区）"},model:{value:t.form.addrDetail,callback:function(e){t.$set(t.form,"addrDetail",e)},expression:"form.addrDetail"}})],1),s("div",{staticClass:"list-box mt9 flex-between"},[t._m(0),s("van-switch",{attrs:{"active-value":"1","inactive-value":"0"},model:{value:t.form.defaultRecv,callback:function(e){t.$set(t.form,"defaultRecv",e)},expression:"form.defaultRecv"}})],1),s("div",{staticClass:"btn mt36",on:{click:t.submitForm}},[t._v(" 保存并使用 ")])],1)])},a=[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("p",{staticClass:"ft14"},[t._v("设为默认收货地址")]),s("p",{staticClass:"mt12 gray"},[t._v("提醒：每次下单后会默认推荐使用该地址")])])}],r=(s(7658),{name:"newAddress",data(){return{form:{contacter:"",contactPhone:"",provId:"",cityId:"",provId:"",addrDetail:"",defaultRecv:0},addressList:[],show:!1,fieldNames:{text:"name",value:"branchId",children:"items"},addressStr:"",cascaderValue:"",addressId:[],selectedOptions:{},isArray:!0,id:"",index:0,filterCounty:[],query:{tenantId:10037279,pageSize:10,pageNow:1},initList:[]}},created(){this.initCity(81e5).then((t=>{this.addressList=t,this.isRouteType(t)})),this.initAddress()},methods:{isRouteType(t){if(this.form.operType=this.$route.query.type||"ADD","UPD"==this.$route.query.type){this.addressList=t;let e=this.$route.query;this.form.contacter=e.contacter,this.form.contactPhone=e.contactPhone,this.form.provId=e.provId,this.form.cityId=e.cityId,this.form.countyId=e.countyId,this.form.addrDetail=e.addrDetail,this.form.defaultRecv=e.defaultRecv,this.form.addrId=e.addrId,this.cascaderValue=1*this.form.provId,this.id=1*this.form.provId}},onAddressPopup(){this.$refs.addressRef.onOpen()},submitForm(){if(this.form.contactPhone==this.$route.query.contactPhone)delete this.form.contactPhone;else{let t=/^(13[0-9]|14[01456879]|15[0-35-9]|16[2567]|17[0-8]|18[0-9]|19[0-35-9])\d{8}$/;if(!t.test(this.form.contactPhone))return this.$toast("请输入正确电话号码")}1==this.form.defaultRecv&&this.resetArray(),this.operation(this.form)},resetArray(){this.initList.map((t=>{if(1==t.defaultRecv){let e={defaultRecv:0,operType:"UPD",tenantId:t.tenantId,addrId:t.addrId,shardingId:t.shardingId};this.$api.managerCustAddr(e).catch((t=>{this.$toast(t.msg)}))}}))},onOpen(){this.show=!0},operation(t){this.$api.managerCustAddr(t).then((t=>{"core.0000"==t.code?(this.$toast(t.reason),this.$router.go(-1)):this.$toast(t.reason)})).catch((t=>{this.$toast(t.msg)}))},initCity(t){return this.$api.getUtilBranchInfoList({parentId:t})},onChangeCity({value:t,selectedOptions:e,tabIndex:s}){this.$set(e[s],"items",[]),2==s&&(e[s].items=null);let i=e[s];this.initCity(t).then((t=>{if(t){if(i.items=t||[],"UPD"==this.$route.query.type){let t=this.$route.query.countyId;if(t&&2==this.index||!t&&1==this.index)return;this.id=0==this.index?this.form.cityId:this.form.countyId,this.filterCounty.push(i.items.filter((t=>t.branchId==this.id))[0]),this.index++}}else i.items=null,e.length<=3&&this.filterCity(e)}))},onFinish({selectedOptions:t}){this.filterCity(t)},filterCity(t){this.show=!1;let e=["provId","cityId","countyId"],s=[];t.map(((t,i)=>{this.form[e[i]]=t.branchId||"",s.push(t.name)})),this.addressStr=s.join("/")},onClose(){this.show=!1},initAddress(){this.$api.qryCustAddrListInfoByTenantId({...this.query}).then((t=>{"core.0000"==t.code?this.initList=t.data.list:this.$toast(t.msg)})).catch((t=>{this.$toast(t.msg)}))}},watch:{id(t){this.cascaderValue=1*t,0==this.index&&this.filterCounty.push(this.addressList.filter((e=>e.branchId==t))[0]),this.onChangeCity({value:t,selectedOptions:this.filterCounty,tabIndex:this.index})}}}),o=r,n=s(3736),d=(0,n.Z)(o,i,a,!1,null,"42a9ef02",null),c=d.exports}}]);